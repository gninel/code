# 采访模式测试用例清单

**版本**: v1.0.0
**日期**: 2025-12-28
**状态**: ✅ 全部通过

---

## 测试用例总览

| 测试组 | 用例数 | 通过 | 失败 | 通过率 |
|--------|--------|------|------|--------|
| TC1: 启动新采访会话 | 3 | 3 | 0 | 100% |
| TC2: 回答问题流程 | 3 | 3 | 0 | 100% |
| TC3: 跳过问题流程 | 2 | 2 | 0 | 100% |
| TC4: 会话结束和恢复 | 3 | 3 | 0 | 100% |
| TC5: AI问题生成策略 | 2 | 2 | 0 | 100% |
| TC6: 数据持久化 | 2 | 2 | 0 | 100% |
| TC7: 错误处理 | 2 | 2 | 0 | 100% |
| TC8: 边界条件 | 3 | 3 | 0 | 100% |
| **总计** | **20** | **20** | **0** | **100%** |

---

## TC1: 启动新采访会话

### TC1.1 - 成功启动新会话并生成第一个问题 ✅

**优先级**: P0 (关键)
**前置条件**: 用户已有历史语音记录
**测试步骤**:
1. 准备测试数据：2条历史语音记录
2. 调用 `InterviewService.startNewSession()`
3. 验证返回的会话对象

**预期结果**:
- 会话对象不为null
- `isActive` = true
- `questions.length` = 1
- `currentQuestionIndex` = 0
- `progress` = 0.0
- 第一个问题内容符合用户历史记录

**实际结果**: ✅ 通过

---

### TC1.2 - 在没有历史记录时启动会话 ✅

**优先级**: P1 (重要)
**前置条件**: 用户无历史语音记录
**测试步骤**:
1. 模拟空的语音记录列表
2. 调用 `InterviewService.startNewSession()`
3. 验证返回的会话

**预期结果**:
- 会话成功创建
- 生成通用开场问题（如"请介绍一下您自己。"）

**实际结果**: ✅ 通过

---

### TC1.3 - AI服务失败时抛出异常 ✅

**优先级**: P1 (重要)
**前置条件**: AI服务不可用
**测试步骤**:
1. Mock AI服务抛出异常
2. 尝试调用 `startNewSession()`
3. 捕获异常

**预期结果**:
- 抛出 `Exception` 异常
- 异常信息包含"AI服务连接失败"

**实际结果**: ✅ 通过

---

## TC2: 回答问题流程

### TC2.1 - 成功保存回答并生成下一个问题 ✅

**优先级**: P0 (关键)
**前置条件**: 已启动采访会话
**测试数据**:
- 回答文本: "我的童年在农村度过，每天和小伙伴们一起玩耍，非常快乐..."
- 音频文件: /path/to/audio.aac
- 时长: 120秒

**测试步骤**:
1. 启动新会话
2. 调用 `answerCurrentQuestion(answerText, audioFilePath, duration)`
3. 验证更新后的会话

**预期结果**:
- 会话包含2个问题
- 第一个问题的 `answer` = answerText
- 第一个问题的 `isAnswered` = true
- 第二个问题已生成
- `currentQuestionIndex` = 1
- `progress` = 0.5

**实际结果**: ✅ 通过

---

### TC2.2 - 仅保存文本回答（无音频） ✅

**优先级**: P1 (重要)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 调用 `answerCurrentQuestion("这是一个文字回答")` （不传音频文件）
2. 验证会话更新

**预期结果**:
- 文本回答成功保存
- 问题标记为已回答
- 不调用语音记录保存方法

**实际结果**: ✅ 通过

---

### TC2.3 - 正确计算回答进度 ✅

**优先级**: P1 (重要)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 连续回答3个问题
2. 在每次回答后检查进度

**预期结果**:
- 回答第1个问题后：progress ≈ 0.5 (1/2)
- 回答第2个问题后：progress ≈ 0.67 (2/3)
- 回答第3个问题后：progress = 0.75 (3/4)

**实际结果**: ✅ 通过

---

## TC3: 跳过问题流程

### TC3.1 - 成功跳过问题并生成下一个问题 ✅

**优先级**: P1 (重要)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 调用 `skipCurrentQuestion()`
2. 验证会话更新

**预期结果**:
- 第一个问题的 `isSkipped` = true
- 第一个问题的 `isAnswered` = false
- 生成了第二个问题
- `currentQuestionIndex` = 1
- `skippedQuestions.length` = 1

**实际结果**: ✅ 通过

---

### TC3.2 - 统计已跳过的问题数量 ✅

**优先级**: P2 (一般)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 连续跳过3个问题
2. 验证跳过计数

**预期结果**:
- 每次跳过后，`skippedQuestions.length` 递增
- 跳过3次后：`skippedQuestions.length` = 3

**实际结果**: ✅ 通过

---

## TC4: 会话结束和恢复

### TC4.1 - 成功结束会话 ✅

**优先级**: P0 (关键)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 回答几个问题
2. 调用 `endSession()`
3. 验证会话状态

**预期结果**:
- 会话状态更新为非活跃
- 数据库保存操作执行

**实际结果**: ✅ 通过

---

### TC4.2 - 成功恢复上次的会话 ✅

**优先级**: P1 (重要)
**前置条件**: 数据库中存在活跃会话
**测试步骤**:
1. 调用 `loadLastSession()`
2. 验证返回的会话

**预期结果**:
- 返回的会话不为null
- `isActive` = true
- `questions` 不为空
- `answeredQuestions` 不为空

**实际结果**: ✅ 通过

---

### TC4.3 - 无保存会话时返回null ✅

**优先级**: P2 (一般)
**前置条件**: 数据库中无活跃会话
**测试步骤**:
1. 调用 `loadLastSession()`
2. 验证返回值

**预期结果**:
- 返回值为 `null`

**实际结果**: ✅ 通过

---

## TC5: AI问题生成策略

### TC5.1 - 基于上下文生成相关问题 ✅

**优先级**: P1 (重要)
**前置条件**: 已回答第一个问题
**测试数据**:
- 用户历史: "童年: 在农村长大"
- 第一个回答: "我在农村度过了快乐的童年，经常和小伙伴们玩耍。"

**测试步骤**:
1. 启动新会话
2. 回答第一个问题
3. 验证第二个问题

**预期结果**:
- 第二个问题与第一个回答相关
- 问题包含关键词"农村"
- 示例: "您在农村生活时有什么难忘的经历吗？"

**实际结果**: ✅ 通过

---

### TC5.2 - 不同阶段使用不同策略 ✅

**优先级**: P2 (一般)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 连续回答6个问题
2. 验证AI服务调用次数

**预期结果**:
- AI服务被调用6次
- 每次调用都传递了正确的上下文（已回答问题列表）

**实际结果**: ✅ 通过

---

## TC6: 数据持久化

### TC6.1 - 每次更新后保存会话 ✅

**优先级**: P0 (关键)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 启动新会话
2. 回答问题
3. 验证会话更新

**预期结果**:
- 会话创建成功并处于活跃状态
- 回答后会话包含2个问题
- 第一个问题标记为已回答

**实际结果**: ✅ 通过

---

### TC6.2 - 跳过问题后保存会话 ✅

**优先级**: P1 (重要)
**前置条件**: 已启动采访会话
**测试步骤**:
1. 跳过当前问题
2. 验证会话更新

**预期结果**:
- 会话包含2个问题
- 第一个问题标记为已跳过

**实际结果**: ✅ 通过

---

## TC7: 错误处理

### TC7.1 - 正确处理数据库操作 ✅

**优先级**: P1 (重要)
**前置条件**: Mock数据库环境
**测试步骤**:
1. 使用NiceMocks配置数据库
2. 启动新会话
3. 验证会话创建

**预期结果**:
- 会话创建成功
- 会话处于活跃状态
- 核心逻辑不受数据库mock影响

**实际结果**: ✅ 通过

---

### TC7.2 - AI服务超时时抛出异常 ✅

**优先级**: P1 (重要)
**前置条件**: AI服务响应缓慢
**测试配置**:
- 模拟AI服务延迟60秒
- 设置超时时间为5秒

**测试步骤**:
1. Mock AI服务延迟
2. 调用 `startNewSession().timeout(Duration(seconds: 5))`
3. 捕获超时异常

**预期结果**:
- 在5秒内触发 `TimeoutException`

**实际结果**: ✅ 通过

---

## TC8: 边界条件

### TC8.1 - 处理空白回答 ✅

**优先级**: P2 (一般)
**前置条件**: 已启动采访会话
**测试数据**: ""（空字符串）
**测试步骤**:
1. 调用 `answerCurrentQuestion("")`
2. 验证会话更新

**预期结果**:
- 空白回答成功保存
- 问题标记为已回答

**实际结果**: ✅ 通过

---

### TC8.2 - 处理超长回答 ✅

**优先级**: P2 (一般)
**前置条件**: 已启动采访会话
**测试数据**: 5000个字符的字符串
**测试步骤**:
1. 调用 `answerCurrentQuestion(longAnswer)`
2. 验证会话更新

**预期结果**:
- 超长回答成功保存
- `answer.length` = 5000

**实际结果**: ✅ 通过

---

### TC8.3 - 处理特殊字符 ✅

**优先级**: P2 (一般)
**前置条件**: 已启动采访会话
**测试数据**: `"这是一个回答！@#$%^&*()_+-=[]{}|;:'\",.<>?/\`~\n\t"`
**测试步骤**:
1. 调用 `answerCurrentQuestion(specialAnswer)`
2. 验证会话更新

**预期结果**:
- 特殊字符正确保存
- 转义字符正确处理

**实际结果**: ✅ 通过

---

## 测试环境

- **Flutter版本**: 3.10+
- **Dart版本**: 3.0+
- **测试框架**: flutter_test
- **Mock工具**: mockito 5.4.0
- **执行平台**: macOS

## 测试执行记录

- **总测试用例**: 20
- **执行通过**: 20
- **执行失败**: 0
- **执行跳过**: 0
- **测试通过率**: 100%
- **执行时长**: ~5秒

## 缺陷记录

**无缺陷** ✅

## 改进建议

1. **增加UI测试** - 测试InterviewWidget组件交互
2. **增加BLoC测试** - 测试状态管理流转
3. **增加端到端测试** - 测试完整用户流程
4. **性能测试** - 测试大规模问题列表场景

---

**文档版本**: v1.0.0
**最后更新**: 2025-12-28
**维护者**: 测试团队
