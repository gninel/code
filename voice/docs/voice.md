# 语音自传产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
语音自传是一款帮助用户通过语音记录人生经历并自动生成个人自传的智能应用。每个人都可以随时随地用语音讲述自己过往的经历，系统利用大模型技术自动整理成连贯、优美的个人自传。用户可以持续录音，自传将不断丰富和完善。

### 1.2 核心价值
- **降低创作门槛**：无需写作技巧，只需开口讲述
- **持续记录**：支持碎片化录音，随时随地记录人生
- **智能整理**：AI自动梳理时间线，组织叙事结构
- **情感留存**：保留声音和文字双重记忆载体

### 1.3 目标用户
- 想要记录人生但缺乏写作能力的普通用户
- 希望为子女留下人生经历的中老年人
- 需要整理个人经历用于求职、自我介绍的职场人士
- 喜欢记录生活的自传爱好者

---

## 2. 功能需求

### 2.1 录音页面

#### 功能描述
提供简洁的录音界面，让用户能够轻松录制语音并实时转换为文字。

#### 核心功能
- **录音控制**
  - 点击按钮开始录音
  - 显示录音时长
  - 支持暂停/继续录音
  - 点击停止结束录音
  
- **实时转写**
  - 录音过程中实时显示转写的文字
  - 支持多语言识别（优先支持中文）
  - 显示转写置信度/准确度提示

- **录音预览**
  - 停止录音后可预览转写结果
  - 支持编辑修正转写错误
  - 可添加标签或备注（如：时间段、主题）

- **保存选项**
  - 保存录音和转写文字
  - 支持取消/删除当前录音
  - 保存时可选填录音标题

#### 采访模式

**功能描述**
AI 作为自传作家模拟提出一个个问题，用户通过语音回答问题，系统记录并处理回答内容。该模式为不擅长自我表达的用户提供引导，帮助他们更系统地回忆和讲述人生经历。

**核心功能**
- **AI 问答引导**
  - AI 自动生成个性化问题序列
  - 问题以文字形式清晰展示在界面上
  - 问题基于用户已有内容和自传结构智能生成
  - 支持多种问题类型：童年回忆、求学经历、工作故事、家庭情感等

- **语音回答**
  - 用户通过语音回答 AI 提出的问题
  - 实时录音和语音转文字
  - 录音控制与自主录音模式一致
  - 支持暂停/继续/停止录音

- **内容处理**
  - 后续处理流程与自主录音完全一致
  - 回答内容记录保存为语音记录
  - 支持编辑修正转写文字
  - 自动关联到对应的问题和主题

- **智能整合**
  - 回答内容可自动整理整合进自传
  - AI 将零散回答组织成连贯叙事
  - 智能判断内容所属章节和位置
  - 保持自传整体结构和风格一致

- **问题管理**
  - 显示当前问题和问题进度
  - 支持跳过当前问题
  - 支持重新回答问题（仅限未回答过的问题）
  - 记录已回答问题的历史
  - **已回答的问题不会重复出现**，确保每个问题只提问一次

**问题生成逻辑**
1. **初始分析**：分析用户已有录音记录，了解基本人生经历
2. **结构规划**：根据自传章节结构，规划问题序列
3. **个性化生成**：结合用户背景，生成个性化问题
4. **去重过滤**：排除已回答过的问题，确保问题不重复
5. **动态调整**：根据用户回答，动态调整后续问题
6. **补充引导**：识别内容空白点，主动引导补充

**界面要素**
- 问题显示区域（大号字体，清晰可读）
- 当前问题进度指示（如：问题 3/15）
- 录音控制按钮（与自主录音共享）
- 实时转写文字显示区域
- 操作按钮（跳过、重新回答、继续下一个）

**AI 提示词示例**
```
你是一位专业的自传作家。请根据用户已有的人生经历，生成一个引导性问题，帮助用户更深入地讲述自己的故事。

用户已有内容概述：
[用户已有录音内容的简要分析]

已回答过的问题：
[已回答问题列表，确保不重复]

要求：
1. 问题要具体、有针对性，避免过于宽泛
2. 问题要能引导用户回忆具体经历和情感
3. 每次只生成一个问题
4. 语言亲切、自然，像朋友聊天一样
5. **严格避免重复已回答过的问题**
6. 如果已回答问题较多，优先挖掘用户未提及的人生阶段

请生成一个引导性问题。
```

**用户体验流程**
1. 用户选择"采访模式"
2. AI 分析用户背景，生成第一个问题
3. 界面显示问题（如："您还记得童年时最难忘的一次经历吗？"）
4. 用户点击录音按钮开始回答
5. 实时显示转写文字
6. 用户停止录音，预览并确认
7. 保存回答记录
8. AI 基于回答生成下一个问题
9. 重复步骤 3-8，直到用户选择结束或问题序列完成

**与自主录音的对比**
| 特性 | 自主录音 | 采访模式 |
|------|---------|---------|
| 发起方式 | 用户自主选择主题 | AI 引导提问 |
| 适用场景 | 有明确表达意愿的用户 | 不擅长表达或需要引导的用户 |
| 内容结构 | 自由、碎片化 | 结构化、系统性 |
| 后续处理 | 完全一致 | 完全一致 |
| 自传整合 | 需手动组织 | 智能关联章节 |

#### 界面要素
- 大号录音按钮（清晰的视觉反馈）
- 录音时长计时器
- 实时文字转写显示区
- 编辑/保存/取消按钮

---

### 2.2 记录页面

#### 功能描述
展示所有历史录音记录，方便用户查看、管理和编辑过往的录音内容。

#### 核心功能
- **记录列表**
  - 按时间倒序显示所有录音
  - 每条记录显示：
    - 录音标题（默认为"录音 + 日期时间"）
    - 录音时长
    - 创建日期时间
    - 转写文字预览（前100字）
    - 标签（如有）

- **记录详情**
  - 点击进入单条记录详情页
  - 显示完整转写文字
  - 支持播放原始录音
  - 显示录音元数据（时长、大小、日期等）

- **编辑功能**
  - 修改录音标题
  - 编辑转写文字
  - 添加/修改标签
  - 添加备注

- **管理功能**
  - 删除单条记录
  - 批量删除
  - 搜索录音（按标题、内容、标签）
  - 按标签筛选

#### 界面要素
- 列表视图（卡片式或列表式）
- 搜索框
- 筛选/排序选项
- 操作菜单（编辑、删除）

---

### 2.3 自传页面


#### 功能描述
根据录音记录生成完整的个人自传，支持持续更新和增量生成。

#### 核心功能
- **生成自传**
  - 首次生成：点击"生成自传"按钮，系统分析所有录音记录，生成完整自传
  - 生成过程显示进度提示
  - 生成完成后展示自传内容

- **增量更新**
  - 检测是否有新录音未纳入自传
  - 点击"更新自传"按钮
  - 系统将新录音内容智能插入到自传合适位置
  - 保持自传的连贯性和时间线逻辑

- **自传展示**
  - 分章节展示自传内容
  - 章节可能按：童年、少年、青年、工作、家庭等主题划分
  - 或按时间线：出生-10岁、10-20岁等阶段划分
  - 支持目录导航

- **编辑优化**
  - 用户可手动编辑自传内容
  - 标记哪些段落来源于哪些录音
  - 重新生成特定章节

- **导出分享**
  - 导出为PDF、Word、纯文本等格式
  - 生成分享链接
  - 打印预览

#### 生成逻辑
AI大模型处理流程：
1. **内容分析**：分析所有录音文字，提取关键信息（时间、地点、人物、事件）
2. **时间线构建**：根据用户叙述构建人生时间线
3. **主题归类**：将相关经历归类到相应主题章节
4. **叙事整合**：将碎片化内容整合成连贯的叙事
5. **语言润色**：优化语言表达，使其更加流畅优美
6. **增量更新**：新内容智能插入，保持整体连贯

#### 界面要素
- "生成自传"/"更新自传"按钮
- 生成进度指示器
- 目录导航
- 自传内容展示区
- 编辑按钮
- 导出/分享按钮

---

## 3. 技术架构

### 3.1 技术栈建议

#### 前端
- **框架**：Flutter（已使用，支持跨平台）
- **状态管理**：BLoC pattern（已使用）
- **音频录制**：record package
- **音频播放**：audioplayers package
- **文件管理**：path_provider, file_picker

#### 后端
- **服务架构**：微服务或 Serverless
- **API**：RESTful API 或 GraphQL
- **数据库**：
  - 结构化数据：PostgreSQL / MySQL
  - 文件存储：云存储（AWS S3 / 阿里云 OSS）

#### AI服务
- **语音转文字**：
  - 阿里云语音识别 ASR
  - 腾讯云语音识别
  - Google Cloud Speech-to-Text
  
- **大模型生成**：
  - **统一使用字节跳动豆包AI模型**
  - 应用场景包括：
    - 采访模式问题生成
    - 自传内容生成和更新
    - 内容润色和优化
    - 智能章节划分
    - 文字整理和归纳

### 3.2 系统架构图

```
┌─────────────┐
│   Flutter   │
│   前端应用   │
└──────┬──────┘
       │
       ├─────────────────┬─────────────────┐
       │                 │                 │
┌──────▼──────┐  ┌──────▼──────┐  ┌──────▼──────┐
│  录音模块    │  │  记录管理    │  │  自传生成    │
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                 │                 │
       └─────────────────┼─────────────────┘
                         │
                  ┌──────▼──────┐
                  │   API网关    │
                  └──────┬──────┘
                         │
       ┌─────────────────┼─────────────────┐
       │                 │                 │
┌──────▼──────┐  ┌──────▼──────┐  ┌──────▼──────┐
│  ASR服务     │  │  数据服务    │  │  大模型服务  │
│  (语音转文字) │  │  (CRUD)     │  │  (自传生成)  │
└─────────────┘  └──────┬──────┘  └─────────────┘
                        │
                 ┌──────▼──────┐
                 │   数据库     │
                 │  + 云存储    │
                 └─────────────┘
```

### 3.3 数据流

1. **录音流程**：录音 → 本地保存 → 上传云存储 → 调用ASR → 保存转写结果 → 展示给用户
2. **记录管理**：查询数据库 → 返回列表 → 展示/编辑 → 更新数据库
3. **自传生成**：
   - 获取所有/新增录音记录
   - 调用大模型API（传入录音文字 + 已有自传）
   - 大模型返回生成/更新的自传
   - 保存自传内容
   - 展示给用户

---

## 4. 数据模型

### 4.1 录音记录 (Recording)

```dart
class Recording {
  String id;                    // 唯一标识
  String userId;                // 用户ID
  String title;                 // 录音标题
  String audioFileUrl;          // 音频文件URL
  int duration;                 // 时长（秒）
  DateTime createdAt;           // 创建时间
  DateTime updatedAt;           // 更新时间
  String transcription;         // 转写文字
  List<String> tags;            // 标签
  String? note;                 // 备注
  bool isIncludedInBio;         // 是否已纳入自传
}
```

### 4.2 自传 (Biography)

```dart
class Biography {
  String id;                    // 唯一标识
  String userId;                // 用户ID
  String content;               // 自传完整内容
  List<Chapter> chapters;       // 章节列表
  DateTime createdAt;           // 首次生成时间
  DateTime lastUpdatedAt;       // 最后更新时间
  int version;                  // 版本号
  List<String> includedRecordingIds;  // 已包含的录音ID列表
}

class Chapter {
  String id;                    // 章节ID
  String title;                 // 章节标题
  String content;               // 章节内容
  int order;                    // 章节顺序
  List<String> sourceRecordingIds;  // 来源录音ID列表
}
```

### 4.3 用户 (User)

```dart
class User {
  String id;                    // 用户ID
  String name;                  // 姓名
  String? email;                // 邮箱
  String? avatar;               // 头像URL
  DateTime createdAt;           // 注册时间
  UserPreferences preferences;  // 用户偏好设置
}

class UserPreferences {
  String language;              // 语言偏好
  String bioStyle;              // 自传风格（正式/轻松/文学等）
  bool autoUpdate;              // 是否自动更新自传
}
```

---

## 5. 用户界面设计

### 5.1 导航结构

底部导航栏：
- 📝 **录音**（Recording）
- 📋 **记录**（Records）
- 📖 **自传**（Biography）
- 👤 **我的**（Profile）

### 5.2 页面线框图描述

#### 录音页面
```
┌─────────────────────────┐
│      ← 录音              │
├─────────────────────────┤
│                         │
│    录音时长: 00:15      │
│                         │
│   ┌─────────────────┐   │
│   │                 │   │
│   │   🔴 [录音中]   │   │
│   │                 │   │
│   └─────────────────┘   │
│                         │
│  实时转写文字显示区域    │
│  ┌─────────────────┐   │
│  │ 今天我想说一说   │   │
│  │ 我的童年经历...  │   │
│  └─────────────────┘   │
│                         │
│   [暂停]     [停止]     │
│                         │
└─────────────────────────┘
```


#### 记录页面
```
┌─────────────────────────┐
│  记录        🔍  ⚙️      │
├─────────────────────────┤
│  [搜索录音...]          │
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │ 童年回忆             │ │
│ │ 2024-11-24  5分30秒  │ │
│ │ 今天我想说一说我的... │ │
│ │ #童年 #家乡          │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 大学时光             │ │
│ │ 2024-11-23  8分12秒  │ │
│ │ 那是一个秋天的下午... │ │
│ │ #大学 #青春          │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ ...                 │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

#### 自传页面
```
┌─────────────────────────┐
│  我的自传      ⋮         │
├─────────────────────────┤
│  最后更新: 2024-11-24   │
│  [📥 导出] [🔄 更新]    │
├─────────────────────────┤
│  目录                   │
│  • 童年时光             │
│  • 少年求学             │
│  • 大学岁月             │
│  • 工作生涯             │
├─────────────────────────┤
│                         │
│  第一章：童年时光        │
│  ─────────────────      │
│                         │
│  我出生在一个小城市，    │
│  父母都是普通的工人。    │
│  童年的记忆里，最深刻的  │
│  是老家院子里那棵...     │
│                         │
│  [查看来源录音 2条]      │
│                         │
└─────────────────────────┘
```

---

## 6. 关键流程

### 6.1 首次录音流程
1. 用户打开应用，进入录音页面
2. 点击录音按钮开始录音
3. 实时显示录音时长和转写文字
4. 点击停止按钮结束录音
5. 预览转写结果，可编辑修正
6. 添加标题、标签（可选）
7. 点击保存，录音上传至云端
8. 转写结果保存到数据库
9. 跳转到记录页面，显示新增记录

### 6.2 生成自传流程
1. 用户进入自传页面
2. 首次使用显示"生成自传"按钮
3. 点击按钮，系统获取所有录音记录
4. 调用大模型API进行处理：
   - 分析所有录音内容
   - 提取时间线和关键事件
   - 组织章节结构
   - 生成连贯叙事
5. 显示生成进度（如：分析中、生成中）
6. 生成完成，展示自传内容
7. 保存到数据库

### 6.3 增量更新流程
1. 用户录制新的语音后
2. 进入自传页面
3. 系统检测到有新录音未纳入自传
4. 显示"有新内容，点击更新"提示
5. 点击"更新自传"按钮
6. 调用大模型API：
   - 传入：已有自传 + 新录音内容
   - 提示词：将新内容智能插入到合适位置
7. 模型返回更新后的完整自传
8. 对比显示更新了哪些部分（可选）
9. 保存新版本自传
10. 标记新录音为"已纳入自传"

---

## 7. 非功能需求

### 7.1 性能要求
- 录音转写延迟 < 2秒（实时转写）
- 自传生成时间 < 30秒（100条录音以内）
- 页面加载时间 < 1秒
- 支持离线录音，联网后上传

### 7.2 安全与隐私
- 所有数据传输使用HTTPS加密
- 录音文件和转写内容仅用户本人可见
- 支持设置访问密码或生物识别
- 提供数据导出和删除账号功能
- 遵守GDPR和个人信息保护法

### 7.3 可用性
- 简洁直观的界面，降低学习成本
- 支持无障碍访问（字体大小、语音播报）
- 多平台支持（iOS、Android、Web）
- 支持多语言界面

### 7.4 可扩展性
- 支持插件或模板系统（不同风格的自传）
- 未来可加入照片、视频等多媒体内容
- 支持多人协作（家庭自传）
- 可接入更多AI能力（如生成配图、视频）

---

## 8. 技术实现要点

### 8.1 录音与转写
- 使用设备麦克风录音，保存为常用音频格式（AAC/MP3）
- 实时流式传输到ASR服务获取转写
- 处理网络波动，支持断点续传
- 本地缓存，防止数据丢失

### 8.2 大模型集成
**提示词设计示例**：

首次生成：
```
你是专业的自传作家。请根据以下录音转写内容，为用户生成一篇个人自传。

要求：
1. 分析内容，构建时间线
2. 按照人生阶段划分章节（童年、少年、求学、工作、家庭等）
3. 使用第一人称叙述
4. 语言流畅、真挚、有温度
5. 保留用户的独特经历和情感

录音内容：
[所有录音转写文字]

请生成自传，使用markdown格式，划分章节。
```

增量更新：
```
以下是用户已有的自传和新增的录音内容。请将新内容智能地融入到自传中合适的位置。

已有自传：
[现有自传全文]

新增录音：
[新录音转写文字]

要求：
1. 判断新内容所属的时间段和主题
2. 插入到对应章节，保持叙事连贯
3. 如需要，可新增章节
4. 保持整体结构和风格一致
5. 标注更新的部分（用【新增】标记）

请返回更新后的完整自传。
```

### 8.3 数据同步策略
- 本地优先：录音先保存到本地
- 后台上传：录音和转写异步上传
- 增量同步：只同步变化的数据
- 冲突处理：以服务端为准，或提示用户选择

---

## 9. 里程碑规划

### Phase 1: MVP（最小可行产品）- 4-6周
- ✅ 录音功能
- ✅ 语音转文字
- ✅ 记录列表和详情
- ✅ 基础自传生成
- ✅ 简单的UI界面

### Phase 2: 完善功能 - 6-8周
- ✅ 增量更新自传
- ✅ 编辑和标签功能
- ✅ 搜索和筛选
- ✅ 导出功能（PDF、Word）
- ✅ 优化UI/UX

### Phase 3: 增强体验 - 8-10周
- ✅ 多种自传风格（正式、轻松、文学）
- ✅ 章节自定义
- ✅ 分享功能
- ✅ 数据统计和可视化
- ✅ 性能优化

### Phase 4: 高级功能 - 未来
- 🔮 多媒体支持（照片、视频）
- 🔮 AI配图
- 🔮 生成音频自传（文字转语音）
- 🔮 家庭多人协作
- 🔮 社区功能

---

## 10. 成功指标

### 用户指标
- DAU（日活跃用户）
- 录音完成率（开始录音 vs 保存录音）
- 自传生成率（至少生成一次自传的用户比例）
- 用户留存率（7天、30天）

### 产品指标
- 平均每用户录音数量
- 平均录音时长
- 自传更新频率
- 导出/分享次数

### 技术指标
- 转写准确率 > 90%
- API响应时间 < 2秒
- 系统可用性 > 99.5%
- 崩溃率 < 0.1%

---

## 11. 风险与挑战

### 技术风险
- **ASR准确率**：方言、口音可能影响转写质量
  - 缓解：提供编辑功能，支持多种ASR引擎切换
  
- **大模型质量**：生成内容可能不符合预期
  - 缓解：优化提示词，提供编辑功能，用户反馈迭代

- **成本控制**：ASR和大模型API成本较高
  - 缓解：优化调用策略，考虑批处理，探索自建模型

### 用户体验风险
- **隐私顾虑**：用户可能担心个人隐私泄露
  - 缓解：明确隐私政策，强化安全措施，本地化存储选项

- **使用门槛**：中老年用户可能不习惯使用
  - 缓解：简化操作流程，提供使用教程

### 商业风险
- **市场接受度**：需要验证用户需求是否真实存在
  - 缓解：快速推出MVP，收集用户反馈

---

## 12. 附录

### 12.1 竞品分析
- **录音笔记类**：讯飞语记、印象笔记
- **自传写作类**：StoryWorth、LifeStory
- **差异化**：AI智能整合、持续更新、零写作门槛

### 12.2 参考资料
- Flutter官方文档
- OpenAI API文档
- 各云服务商ASR文档
- Material Design / iOS HIG设计规范

### 12.3 术语表
- **ASR**：Automatic Speech Recognition，自动语音识别
- **LLM**：Large Language Model，大语言模型
- **MVP**：Minimum Viable Product，最小可行产品
- **PRD**：Product Requirements Document，产品需求文档

---

**文档版本**：v1.0  
**创建日期**：2024-11-24  
**最后更新**：2024-11-24  
**负责人**：产品团队
