# 食物热量分析 App 产品需求文档

## 产品概述

### 产品定位
一款基于拍照的智能食物热量分析应用，通过豆包多模态大模型自动识别食物类型和估算热量，帮助用户轻松记录和管理日常饮食健康。

### 核心价值
- **极简操作**：拍照即可获得食物热量信息，无需手动输入
- **AI 驱动**：利用豆包多模态 AI 智能识别食物种类和营养成分
- **数据可视化**：直观展示每日、每周、每月的热量摄入趋势
- **健康管理**：帮助用户了解饮食习惯，实现科学饮食管理

### 目标用户
- 健身减脂人群
- 需要控制热量摄入的用户
- 关注健康饮食的普通用户
- 糖尿病等需要饮食管理的患者

---

## 功能需求

### 1. 首页（拍照识别页）

#### 1.1 核心功能
- **相机按钮**：点击启动相机进行拍照
- **拍照识别**：
  - 调用豆包多模态大模型识别食物
  - 识别食物名称和主要构成
  - 估算食物热量值
- **结果展示**：
  - 显示识别出的食物名称
  - 显示食物主要构成（如：米饭、鸡肉、蔬菜等）
  - 显示估算的总热量值（千卡）
  - 显示各成分的热量分解
- **保存功能**：点击保存按钮将记录存储到本地

#### 1.2 UI 设计要点
- 简洁的首页设计，突出相机按钮
- 拍照后立即显示 AI 分析进度
- 结果展示清晰直观，热量数值醒目
- 提供重新拍照和保存两个操作按钮

#### 1.3 交互流程
```
进入首页 → 点击相机按钮 → 拍照 → AI 分析中... → 显示结果 → 保存/重拍
```

---

### 2. 吃的啥页（饮食记录页）

#### 2.1 核心功能
- **历史记录列表**：
  - 按时间倒序显示所有保存的食物记录
  - 每条记录显示：拍摄时间、食物照片缩略图、食物名称、热量值
  - 支持点击查看详情
  
- **热量趋势图**：
  - 周视图：展示最近 7 天每天的热量总值折线图/柱状图
  - 月视图：展示最近 30 天每天的热量总值折线图/柱状图
  - 显示平均热量、最高/最低热量等统计信息

- **筛选和统计**：
  - 按日期筛选记录
  - 显示当日/当周/当月的总热量
  - 提供删除单条记录的功能

#### 2.2 UI 设计要点
- Tab 切换：记录列表、周趋势、月趋势
- 趋势图使用清晰的可视化组件
- 列表项设计简洁，信息一目了然
- 支持下拉刷新和上滑加载更多

#### 2.3 数据展示
**周趋势示例**：
```
热量 (千卡)
2000 |     ●
1800 |   ●   ●
1600 | ●       ●
     |___________
      周一 ... 周日
```

**月趋势示例**：
```
热量 (千卡)
2200 |  ●
2000 |    ● ●
1800 | ●      ●
     |_________
      1日 ... 30日
```

---

## 技术需求

### 3.1 豆包多模态大模型集成

#### API 调用方式
- **接口**：豆包（抖音）多模态 API
- **输入**：食物照片（Base64 编码）+ Prompt
- **输出**：JSON 格式的识别结果

#### 数据格式
**请求格式（参考）**：
```json
{
  "model": "doubao-multimodal",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "image",
          "image_url": "base64_encoded_image"
        },
        {
          "type": "text",
          "text": "请参考 Prompt 文档"
        }
      ]
    }
  ]
}
```

**返回格式（期望）**：
```json
{
  "food_name": "宫保鸡丁盖饭",
  "components": [
    {
      "name": "米饭",
      "portion": "约200克",
      "calories": 230
    },
    {
      "name": "宫保鸡丁",
      "portion": "约150克",
      "calories": 280
    },
    {
      "name": "蔬菜配菜",
      "portion": "约50克",
      "calories": 20
    }
  ],
  "total_calories": 530,
  "confidence": 0.85
}
```

### 3.2 本地数据存储
- 使用 SQLite / SharedPreferences / Hive 存储食物记录
- 数据模型：
  ```dart
  class FoodRecord {
    String id;
    String imagePath;
    String foodName;
    List<FoodComponent> components;
    int totalCalories;
    DateTime timestamp;
  }
  
  class FoodComponent {
    String name;
    String portion;
    int calories;
  }
  ```

### 3.3 图表展示
- 使用 fl_chart / charts_flutter 等库实现趋势图
- 支持交互（点击查看具体数值）

---

## 用户体验要点

### 4.1 性能要求
- 拍照后 AI 识别响应时间 < 5 秒
- 列表滚动流畅，图片加载优化
- 本地数据查询响应迅速

### 4.2 容错处理
- AI 识别失败时提示用户重试
- 网络异常时给出友好提示
- 模糊照片时建议重新拍摄

### 4.3 隐私安全
- 照片仅存储在本地
- 上传到 AI 的照片仅用于识别，不做其他用途
- 提供一键清除所有数据的选项

---

## 开发优先级

### MVP 版本（第一期）
- [x] 首页拍照功能
- [x] 豆包多模态 AI 集成
- [x] 识别结果展示
- [x] 保存到本地
- [x] 历史记录列表展示

### 第二期
- [ ] 周/月趋势图
- [ ] 数据统计功能
- [ ] 记录详情页
- [ ] 删除和编辑功能

### 未来扩展
- [ ] 营养成分详细分析（蛋白质、脂肪、碳水等）
- [ ] 自定义目标热量提醒
- [ ] 分享功能
- [ ] 数据导出

---

## 附录

### 相关文档
- [豆包多模态 Prompt 设计](./PROMPT_DESIGN.md)
- [技术实现方案](./TECH_SPEC.md)
- [UI 设计稿](./UI_DESIGN.md)

### 参考资料
- 豆包 AI 官方文档
- 营养学热量计算标准
